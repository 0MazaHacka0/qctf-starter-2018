## Предварительная настрйка сервиса
### Создать пользователя
Создать пользователя ```passengers``` и дать ему права только на исполнение файлов в своей home директории и невозможность выхода из home директории. То есть пользователь не должен уметь читать флаги (```flag1``` и ```flag2``` в директориях команд), но должен уметь исполнять бинарники (а именно ```main```), которые умеют читать эти флаги. То есть просто так в обычном режиме пользователь не должен уметь читать флаги, только через исполнение бинарника. Я без понятия как это сделать, лучше спросить каких-нибудь админов

### Сгенерировать директории
Перед тем как поднимать сервис, необходимо для начала сгенерировать директории для команд. Делается это через роутер:
```sh
$ python3 router.py prepare
```
Это создаст директории для команд по пути, прописанном в глобальных переменных ```router.py```. Также, это сгенерирует файлы с флагами в каждой директории и создаст директории ```./1``` и ```./2``` (на уровне с ```router.py```), в которых будут лежать файлы ```check.py``` и ```generate.py``` по каждому из тасков (первая уязвимость и вторая уязвимость).


## Что и как

Все настройки по форку самого бинарника лежат в [passengers.xinetd](./passengers.xinetd) (то есть, порт, по которому будет доступен, токен команды итд).
Чтобы поднять сервис необходимо сделать следующее:

```
chmod +x ./setup.sh
./setup.sh
```

После этого можно проверить, что сервис поднялся:
```
nc localhost <port specified in passengers.xinetd>
```

В [setup.sh](./setup.sh) прописаны команды копирования конфига для xinetd в директорию демонов самого xinetd, и, собственно, перезапуск xinetd сервиса. 
Важно отметить, что запускается изначально не сам main, а [router.py](./router.py). Этот скрипт ждёт токен акоманды и на основе токена переходит в директорию для этой команды. В этой директории находятся флаги и бинарник, который затем и запускается.


## Проверка работоспособности
Чтобы понять, что бинарник работает и ничего не сломалось, необходимо запустить ```exploit.py``` файл из ```solutions``` директории на поднятый сервис (предварительно поправив место для коннекта).

## Что нужно изменить/добавить
1. Нужно поменять переменную ```server_args``` в [passengers.xinetd](./passengers.xinetd) на путь до роутера
2. Проделать то же, что в пункте 1 для переменных ```ROOTDIR_PREFIX``` и ```TEAMS_DIR_PREFIX``` в [router.py](./router.py)
3. Нужно впилить chroot перед запуском бинарника, чтобы команды не могли уходить из своих директорий.